$(function(a){function b(){var b=(new RegExp("/wiki/([^&]*)","i")).exec(location.hash);if(b){a("#s").val(b[1].replace(new RegExp("_","g")," "));d(b[1],true)}}function c(a,b){jQuery.getJSON(e+"w/api.php",{fomat:"json",action:"opensearch",search:a,limit:100},function(a){b(a[1])})}function d(b,c){a("base").attr("href",g);a("#content").hide().empty();a("#loading").show();if(!c)location.hash="/wiki/"+b;a.getJSON(e+"w/api.php",{action:"parse",format:"json",page:b,prop:"text"},function(c){function g(b){var c="";a(b).each(function(){c+=this.outerHTML});return c}a("#content").append("<h1>"+b.replace(new RegExp("_","g")," ")+"</h1>\n"+c.parse.text["*"].replace(new RegExp('href="/wiki/',"g"),'data-wiki="1" href="'+e).replace(new RegExp('href="url',"g"),'data-wiki="1" href="'+e));a("#content *").removeAttr("style");a("#toc").remove();a("#content a").not('a[data-wiki="1"]').each(function(){var b=a(this),c=this.href.split("/");if(c[0]!="chrome-extension:"&&c[0][0]!="#"){a(this).on("click",function(){chrome.tabs.create({url:a(this).attr("href")})})}});a(".cquote").each(function(){a(this).after("<blockquote>"+a(this).find("td").eq(1).html()+"</blockquote>");a(this).remove()});a("table > tr > td > span.mbox-text-span").parents().eq(3).replaceWith('<div class="alert alert-info">'+a(this).html()+"</span>");a(".dablink").addClass("alert alert-info");var d="",f=a("h2 .mw-headline").parent();f.each(function(){d+='<details id="'+a(this).find(".mw-headline").attr("id")+'"><summary><h2>'+a(this).find(".mw-headline").text()+"</h2></summary>"+g(a(this).nextUntil("h2"))+"</details>"});f.nextUntil(f).remove();f.remove();a("#content").append(d);a("#loading").hide();if(!b.split("#")[1]){a("#content").show().scrollTop(0)}else{a("#content").show();a("#"+b.split("#")[1]).attr("open","open").scrollTop(0)}})}if(!localStorage["wikiURL"]){localStorage["wikiURL"]="http://en.wikipedia.org/"}var e=localStorage["wikiURL"];if(e[e.length-1]!="/"){e+="/"}var f=document.createElement("a");f.href=e;var g=f.protocol+"//"+f.hostname;a("#back").click(function(){history.back();b();return false});a("#forward").click(function(){history.forward();b();return false});a("#newTab").click(function(){chrome.tabs.create({url:e+"wiki/"+a("#s").val()});return false});a("#s").keypress(function(){a("#s").typeahead({source:c,items:10})});a("#content").on("click",'a[data-wiki="1"]',function(){var b=this.href.split("/"),c=decodeURIComponent(b[b.length-1]);if(c=="")c=decodeURIComponent(b[b.length-2]);a("#s").val(c.replace(new RegExp("_","g")," "));d(c)});a("#search").submit(function(b){d(a("#s").val());return false})})